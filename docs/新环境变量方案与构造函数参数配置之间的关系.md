
# 新环境变量方案与构造函数参数中的字典加载配置之间的关系：

## 构造函数参数配置 vs 新环境变量方案的关系

### 1. **现有配置结构**
```php
'dict_loading' => [
    'strategy' => 'both', // 'both'|'with_tone'|'no_tone' - 字典加载策略
    'lazy_loading' => true, // 是否启用懒加载（默认启用）
    'preload_priority' => ['custom', 'common'], // 预加载优先级
    'lazy_dicts' => ['rare', 'unihan'] // 懒加载的字典类型
]
```

### 2. **新环境变量方案**
新增了三个环境变量：
- `PINYIN_DICT_STRATEGY`: 控制字典加载策略
- `PINYIN_DICT_CACHE_SIZE`: 控制缓存大小  
- `PINYIN_LAZY_LOADING`: 控制懒加载开关

### 3. **关系和优先级**

**配置优先级（从高到低）：**
1. 环境变量（最高优先级）
2. 构造函数传入的 `$options` 参数
3. 默认配置（最低优先级）

**具体实现逻辑：**
```php
// 从环境变量加载配置
$envConfig = $this->loadEnvironmentConfig();
// 环境变量配置会覆盖默认配置
$this->config = array_replace_recursive($this->config, $envConfig, $options);
```

### 4. **映射关系**

| 环境变量 | 对应配置项 | 默认值 | 说明 |
|---------|-----------|--------|------|
| `PINYIN_DICT_STRATEGY` | `dict_loading.strategy` | `both` | 字典加载策略 |
| `PINYIN_DICT_CACHE_SIZE` | `high_freq_cache.size` | `1000` | 缓存大小 |
| `PINYIN_LAZY_LOADING` | `dict_loading.lazy_loading` | `true` | 懒加载开关 |

### 5. **兼容性保证**

- **向后兼容**：如果不设置环境变量，系统使用原有的默认配置
- **灵活配置**：环境变量可以覆盖默认配置，但仍可通过构造函数参数进一步覆盖
- **策略一致性**：新方案中的策略值与现有配置完全一致

### 6. **实际使用场景**

**开发环境：**
```bash
# 开发时使用最小内存配置
export PINYIN_DICT_STRATEGY=no_tone
export PINYIN_DICT_CACHE_SIZE=500
```

**生产环境：**
```bash
# 生产环境使用完整配置
export PINYIN_DICT_STRATEGY=both
export PINYIN_DICT_CACHE_SIZE=2000
```

**测试环境：**
```bash
# 测试环境禁用懒加载，确保测试稳定性
export PINYIN_LAZY_LOADING=false
```

### 7. **核心优势**

1. **环境隔离**：不同环境可以使用不同的字典策略，无需修改代码
2. **部署灵活性**：通过环境变量快速调整性能参数
3. **配置统一**：将分散的配置项集中到环境变量中管理
4. **零侵入**：不影响现有的代码逻辑和配置方式

这个方案本质上是在现有配置系统基础上增加了一层环境变量覆盖，提供了更灵活的部署和运维能力，同时保持了完全的向后兼容性。